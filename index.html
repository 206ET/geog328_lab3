<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lab 3 â€“ Japan & Earthquakes</title>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
  <style>
    :root { --panel-w: 380px; }
    html, body { margin: 0; height: 100%; }
    #map { position: fixed; inset: 0; }
    .panel {
      position: fixed;
      top: 16px;
      right: 16px;
      width: var(--panel-w);
      max-height: calc(100dvh - 32px);
      background: rgba(255,255,255,0.96);
      backdrop-filter: blur(4px);
      border-radius: 14px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      padding: 14px;
      overflow: auto;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }
    h1 { margin: 0 0 8px; font-size: 18px; }
    .sub { font-size: 13px; color: #444; margin: 0 0 12px; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { text-align: left; padding: 4px 6px; border-bottom: 1px solid #ddd; }
    th { cursor: pointer; background: #f0f0f0; }
    tr:hover { background: #f9f9f9; }
  </style>
</head>
<body>
  <div id="map"></div>
  <aside class="panel">
    <h1>Japan & Earthquakes</h1>
    <p class="sub">Dark basemap + 2 datasets + sortable table. Panel hides on small screens.</p>
    <div><a href="./earthquake.html">earthquake.html</a></div>
    <table id="tbl">
      <thead>
        <tr>
          <th data-key="place">Place</th>
          <th data-key="mag">Magnitude</th>
          <th data-key="time">Time (UTC)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </aside>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiMjA2ZXQiLCJhIjoiY21oZHVlNGhsMDZvajJpb3JiYW44NDdkbCJ9.2t0kCjiMB6Mad8U9mEQfKQ';

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/dark-v11',
      center: [138, 37],
      zoom: 3.8
    });

    map.on('load', () => {
      map.addSource('japan', {
        type: 'geojson',
        data: './assets/japan.json'
      });

      map.addLayer({
        id: 'japan-fill',
        type: 'fill',
        source: 'japan',
        paint: {
          'fill-color': '#3bb2d0',
          'fill-opacity': 0.4
        }
      });

      map.addSource('earthquakes', {
        type: 'geojson',
        data: './assets/earthquakes.geojson'
      });

      map.addLayer({
        id: 'earthquakes-point',
        type: 'circle',
        source: 'earthquakes',
        paint: {
          'circle-radius': 6,
          'circle-color': '#ff4b4b',
          'circle-stroke-color': '#fff',
          'circle-stroke-width': 1
        }
      });

      fetch('./assets/earthquakes.geojson')
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#tbl tbody');
          data.features.forEach(f => {
            const row = document.createElement('tr');
            const p = f.properties;
            const date = new Date(p.time).toUTCString();
            row.innerHTML = `<td>${p.place || 'N/A'}</td><td>${p.mag}</td><td>${date}</td>`;
            tbody.appendChild(row);
          });
        });
    });

    document.querySelectorAll('th').forEach(th => {
      th.addEventListener('click', () => {
        const key = th.dataset.key;
        const rows = Array.from(document.querySelector('#tbl tbody').rows);
        const asc = !th.classList.contains('asc');
        document.querySelectorAll('th').forEach(h => h.classList.remove('asc', 'desc'));
        th.classList.add(asc ? 'asc' : 'desc');
        rows.sort((a, b) => {
          const va = a.cells[th.cellIndex].innerText;
          const vb = b.cells[th.cellIndex].innerText;
          return asc ? va.localeCompare(vb, undefined, {numeric:true}) : vb.localeCompare(va, undefined, {numeric:true});
        });
        const tbody = document.querySelector('#tbl tbody');
        tbody.innerHTML = '';
        rows.forEach(r => tbody.appendChild(r));
      });
    });
  </script>
</body>
</html>
